<as-split
    direction="horizontal"
    [gutterSize]="2"
    [unit]="'pixel'"
    (dragEnd)="config.set('menuSize', menuSplit.clientWidth)"
>
    <as-split-area
        #menuSplit
        [size]="config.value.menuCollapsed ? 56 : config.value.menuSize ?? 215"
        [minSize]="config.value.menuCollapsed ? 56 : 215"
        [maxSize]="config.value.menuCollapsed ? 56 : 400"
    >
        <app-menu></app-menu>
    </as-split-area>
    <as-split-area>
        <mat-tab-group
            style="flex: 1"
            [(selectedIndex)]="pages.selectedTabIndex"
        >
            <mat-tab *ngFor="let page of pages.tabs">
                <ng-template mat-tab-label>
                    <div class="tab"
                        [ngx-contextmenu]="tabCtxMenu"
                        [ngx-menu-context]="page"
                    >
                        <mat-icon [fontIcon]="page.icon || 'edit_document'"></mat-icon>
                        <span style="flex: 1">
                            <span>{{page.name?.slice(0, 20)}}</span>
                        </span>
                        <mat-icon (click)="pages.tabs.splice(pages.tabs.indexOf(page), 1)">close</mat-icon>
                    </div>
                </ng-template>
            </mat-tab>
        </mat-tab-group>
        <ng-container *ngFor="let page of pages.tabs; let i = index">
            <div class="container" *ngIf="pages.selectedTabIndex == i" [ngSwitch]="page.kind">
                <ng-container
                    *ngSwitchCase="'code'"
                >
                    <ng-container
                        *ngIf="utils.getPistonRuntimes.length > 0 && checkLangIsExecutable(page)"
                    >
                        <button mat-icon-button class="run-button">
                            <mat-icon (click)="utils.executeCode(page)">play_arrow</mat-icon>
                        </button>
                    </ng-container>
                    <app-vscode
                        [code]="page.content"
                        (codeChange)="pages.onPageContentChange(page, $event)"
                        [language]="page.options?.['language'] || 'auto'"
                        [minimap]="page.options?.['minimap']"
                        [folding]="page.options?.['folding']"
                        [fontSize]="page.options?.['fontSize']"
                        [colorDecorators]="page.options?.['colorDecorators']"
                        [tabSize]="page.options?.['tabSize']"
                        [tabSize]="4"
                    />
                </ng-container>

                <div
                    *ngSwitchCase="'canvas'"
                    style="height: 100%"
                >
                    <app-diagram
                        [page]="page"
                    />
                </div>

                <div
                    *ngSwitchCase="'fetch'"
                    style="height: 100%"
                >
                    <app-fetch-page
                        [page]="page"
                    />
                </div>

                <ngx-stackedit
                    *ngSwitchDefault
                    [mode]="page.readonly ? 'view' : 'edit'"
                    [showPreview]="'off'"
                    [showCodeRunButton]="true"
                    codeRunner="piston"
                    [(value)]="page.content"
                    (valueChange)="pages.onPageContentChange(page, $event)"
                    (onImageUpload)="onImageUpload($event)"
                />
            </div>
        </ng-container>
    </as-split-area>
</as-split>
